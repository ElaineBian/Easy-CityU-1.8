<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ½ï¸ é£Ÿå ‚ç‚¹é¤ - Easy CityU</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ½ï¸</text></svg>">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/canteen.css">
    <link rel="stylesheet" href="css/fontawesome-local.css">
</head>
<body>
    <div class="canteen-container">
        <a href="main.html" class="back-btn">
            <i class="fas fa-arrow-left"></i>
            è¿”å›ä¸»é¡µ
        </a>

        <div class="canteen-header">
            <h1><i class="fas fa-utensils"></i> åŸå¤§é£Ÿå ‚ç‚¹é¤ä¸­å¿ƒ</h1>
            <p>åœ¨çº¿ç‚¹é¤ Â· ç¾é£ŸæŠ•ç¥¨ Â· ä¾¿æ·æœåŠ¡</p>
        </div>

        <div class="canteen-sections">
            <!-- ç‚¹é¤åŒºåŸŸ -->
            <div class="section-card">
                <h2 class="section-title">
                    <i class="fas fa-shopping-cart"></i> åœ¨çº¿ç‚¹é¤
                </h2>
                <iframe 
                    src="https://csd.order.place/home/store/112870?mode=prekiosk" 
                    class="order-frame"
                    title="é£Ÿå ‚ç‚¹é¤ç³»ç»Ÿ">
                </iframe>
            </div>

            <!-- æŠ•ç¥¨åŒºåŸŸ -->
            <div class="section-card voting-section">
                <h2 class="section-title">
                    <i class="fas fa-poll"></i> ç¾é£ŸæŠ•ç¥¨
                </h2>
                
                <div class="vote-status">
                    <p><strong>ä»Šæ—¥æŠ•ç¥¨çŠ¶æ€ï¼š</strong> <span id="voteStatus">å¯ä»¥æŠ•ç¥¨</span></p>
                    <div class="vote-timer" id="voteTimer"></div>
                </div>

                <div id="foodList">
                    <!-- é£Ÿç‰©åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <div class="top-foods">
                    <h4><i class="fas fa-trophy"></i> ä»Šæ—¥äººæ°”æ¦œ</h4>
                    <div id="topFoodsList">
                        <!-- æ’è¡Œæ¦œå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é£Ÿç‰©æ•°æ®
        const foods = [
            { id: 1, name: "çº¢çƒ§è‚‰é¥­", description: "é¦™ç”œè½¯ç³¯çš„çº¢çƒ§è‚‰é…ç™½ç±³é¥­", votes: 45 },
            { id: 2, name: "å®«ä¿é¸¡ä¸", description: "ç»å…¸å·èœï¼Œéº»è¾£é²œé¦™", votes: 38 },
            { id: 3, name: "éº»å©†è±†è…", description: "å«©æ»‘è±†è…é…éº»è¾£æ±¤æ±", votes: 32 },
            { id: 4, name: "ç³–é†‹é‡Œè„Š", description: "é…¸ç”œå¯å£çš„ç»å…¸èœå“", votes: 28 },
            { id: 5, name: "é’æ¤’è‚‰ä¸", description: "æ¸…çˆ½ä¸‹é¥­çš„å®¶å¸¸èœ", votes: 25 },
            { id: 6, name: "ç•ªèŒ„é¸¡è›‹", description: "è¥å…»ä¸°å¯Œçš„ç»å…¸æ­é…", votes: 22 },
            { id: 7, name: "åœŸè±†ä¸", description: "çˆ½è„†å¯å£çš„ç´ èœ", votes: 18 },
            { id: 8, name: "ç™½åˆ‡é¸¡", description: "æ¸…æ·¡é²œç¾çš„ç²¤å¼èœå“", votes: 15 }
        ];

        // æ£€æŸ¥ç”¨æˆ·ä»Šæ—¥æ˜¯å¦å·²æŠ•ç¥¨
        function hasVotedToday() {
            const lastVoteDate = localStorage.getItem('lastVoteDate');
            const today = new Date().toDateString();
            return lastVoteDate === today;
        }

        // è®°å½•æŠ•ç¥¨
        function recordVote() {
            const today = new Date().toDateString();
            localStorage.setItem('lastVoteDate', today);
        }

        // è·å–ç”¨æˆ·æŠ•ç¥¨æ•°æ®
        function getUserVotes() {
            const votes = localStorage.getItem('userVotes');
            return votes ? JSON.parse(votes) : {};
        }

        // ä¿å­˜ç”¨æˆ·æŠ•ç¥¨æ•°æ®
        function saveUserVotes(votes) {
            localStorage.setItem('userVotes', JSON.stringify(votes));
        }

        // æŠ•ç¥¨åŠŸèƒ½
        function vote(foodId) {
            if (hasVotedToday()) {
                alert('æ‚¨ä»Šå¤©å·²ç»æŠ•è¿‡ç¥¨äº†ï¼Œè¯·æ˜å¤©å†æ¥ï¼');
                return;
            }

            const userVotes = getUserVotes();
            if (!userVotes[foodId]) {
                userVotes[foodId] = 0;
            }
            userVotes[foodId]++;
            
            // æ›´æ–°é£Ÿç‰©æŠ•ç¥¨æ•°
            const food = foods.find(f => f.id === foodId);
            if (food) {
                food.votes++;
            }

            saveUserVotes(userVotes);
            recordVote();
            
            // é‡æ–°æ¸²æŸ“é¡µé¢
            renderFoodList();
            renderTopFoods();
            updateVoteStatus();
            
            // æ˜¾ç¤ºæŠ•ç¥¨æˆåŠŸæ¶ˆæ¯
            showNotification('æŠ•ç¥¨æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼', 'success');
        }

        // æ¸²æŸ“é£Ÿç‰©åˆ—è¡¨
        function renderFoodList() {
            const foodList = document.getElementById('foodList');
            const hasVoted = hasVotedToday();
            
            foodList.innerHTML = foods.map(food => `
                <div class="food-item">
                    <div class="food-info">
                        <div class="food-name">${food.name}</div>
                        <div class="food-description">${food.description}</div>
                    </div>
                    <div class="vote-section">
                        <div class="vote-count">${food.votes}</div>
                        <button class="vote-btn" onclick="vote(${food.id})" ${hasVoted ? 'disabled' : ''}>
                            ${hasVoted ? 'å·²æŠ•ç¥¨' : 'æŠ•ç¥¨'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“æ’è¡Œæ¦œ
        function renderTopFoods() {
            const topFoodsList = document.getElementById('topFoodsList');
            const sortedFoods = [...foods].sort((a, b) => b.votes - a.votes).slice(0, 5);
            
            topFoodsList.innerHTML = sortedFoods.map((food, index) => `
                <div class="top-food-item">
                    <span><span class="rank">${index + 1}.</span>${food.name}</span>
                    <span>${food.votes}ç¥¨</span>
                </div>
            `).join('');
        }

        // æ›´æ–°æŠ•ç¥¨çŠ¶æ€
        function updateVoteStatus() {
            const voteStatus = document.getElementById('voteStatus');
            const voteTimer = document.getElementById('voteTimer');
            
            if (hasVotedToday()) {
                voteStatus.textContent = 'ä»Šæ—¥å·²æŠ•ç¥¨';
                voteStatus.style.color = '#28a745';
                
                // è®¡ç®—åˆ°æ˜å¤©çš„å‰©ä½™æ—¶é—´
                const now = new Date();
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(0, 0, 0, 0);
                
                const timeLeft = tomorrow - now;
                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                
                voteTimer.textContent = `è·ç¦»ä¸‹æ¬¡æŠ•ç¥¨è¿˜æœ‰ ${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
            } else {
                voteStatus.textContent = 'å¯ä»¥æŠ•ç¥¨';
                voteStatus.style.color = '#007bff';
                voteTimer.textContent = 'æ¯äººæ¯å¤©åªèƒ½æŠ•ä¸€ç¥¨ï¼Œè¯·çæƒœæ‚¨çš„é€‰æ‹©ï¼';
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : '#007bff'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            renderFoodList();
            renderTopFoods();
            updateVoteStatus();
            
            // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡å€’è®¡æ—¶
            setInterval(updateVoteStatus, 60000);
        });

        // ä¸»é¢˜åˆ‡æ¢æ”¯æŒ
        function applyTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
        }

        // åº”ç”¨ä¸»é¢˜
        applyTheme();
    </script>
</body>
</html>